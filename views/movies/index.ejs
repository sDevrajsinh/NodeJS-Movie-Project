<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Movie Management System - Manage your movie collection">
    <title>
        <%= title %> | Movie Manager
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <%- include('../partials/navbar') %>

        <main class="main-content">
            <div class="hero-section">
                <div class="container">
                    <h1 class="page-title">
                        <span class="title-gradient">Movie Collection</span>
                    </h1>
                    <p class="page-subtitle">Manage and explore your favorite movies</p>
                </div>
            </div>

            <div class="container">
                <!-- Search and Filter Section -->
                <div class="controls-section">
                    <form action="/movies" method="GET" class="search-form">
                        <div class="search-wrapper">
                            <input type="text" name="search"
                                placeholder="Search movies by title, description, or director..." value="<%= search %>"
                                class="search-input">
                            <button type="submit" class="search-btn">üîç Search</button>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label for="genre">Genre:</label>
                                <select name="genre" id="genre" class="filter-select" onchange="this.form.submit()">
                                    <option value="All" <%=selectedGenre==='All' ? 'selected' : '' %>>All Genres
                                    </option>
                                    <option value="Action" <%=selectedGenre==='Action' ? 'selected' : '' %>>Action
                                    </option>
                                    <option value="Comedy" <%=selectedGenre==='Comedy' ? 'selected' : '' %>>Comedy
                                    </option>
                                    <option value="Drama" <%=selectedGenre==='Drama' ? 'selected' : '' %>>Drama</option>
                                    <option value="Horror" <%=selectedGenre==='Horror' ? 'selected' : '' %>>Horror
                                    </option>
                                    <option value="Sci-Fi" <%=selectedGenre==='Sci-Fi' ? 'selected' : '' %>>Sci-Fi
                                    </option>
                                    <option value="Romance" <%=selectedGenre==='Romance' ? 'selected' : '' %>>Romance
                                    </option>
                                    <option value="Thriller" <%=selectedGenre==='Thriller' ? 'selected' : '' %>>Thriller
                                    </option>
                                    <option value="Documentary" <%=selectedGenre==='Documentary' ? 'selected' : '' %>
                                        >Documentary
                                    </option>
                                    <option value="Animation" <%=selectedGenre==='Animation' ? 'selected' : '' %>
                                        >Animation</option>
                                    <option value="Other" <%=selectedGenre==='Other' ? 'selected' : '' %>>Other</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label for="sort">Sort by:</label>
                                <select name="sort" id="sort" class="filter-select" onchange="this.form.submit()">
                                    <option value="newest" <%=selectedSort==='newest' ? 'selected' : '' %>>Newest First
                                    </option>
                                    <option value="year-desc" <%=selectedSort==='year-desc' ? 'selected' : '' %>>Year
                                        (Newest)
                                    </option>
                                    <option value="year-asc" <%=selectedSort==='year-asc' ? 'selected' : '' %>>Year
                                        (Oldest)
                                    </option>
                                    <option value="title" <%=selectedSort==='title' ? 'selected' : '' %>>Title (A-Z)
                                    </option>
                                    <option value="rating" <%=selectedSort==='rating' ? 'selected' : '' %>>Rating
                                    </option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Movies Grid -->
                <% if (movies.length===0) { %>
                    <div class="empty-state">
                        <div class="empty-icon">üé¨</div>
                        <h2>No Movies Found</h2>
                        <p>Start building your collection by adding your first movie!</p>
                        <a href="/movies/new" class="btn btn-primary">Add Your First Movie</a>
                    </div>
                    <% } else { %>
                        <div class="stats-bar">
                            <p class="stats-text">
                                <span class="stats-number">
                                    <%= movies.length %>
                                </span>
                                <%= movies.length===1 ? 'movie' : 'movies' %> found
                            </p>
                        </div>

                        <div class="movies-grid">
                            <% movies.forEach(movie=> { %>
                                <div class="movie-card" data-genre="<%= movie.genre %>">
                                    <a href="/movies/<%= movie._id %>" class="card-link">
                                        <div class="card-poster">
                                            <img src="<%= movie.poster %>" alt="<%= movie.title %>" loading="lazy">
                                            <div class="card-overlay">
                                                <span class="view-details">View Details ‚Üí</span>
                                            </div>
                                        </div>
                                        <div class="card-content">
                                            <div class="card-header">
                                                <h3 class="card-title">
                                                    <%= movie.title %>
                                                </h3>
                                                <span class="card-year">
                                                    <%= movie.year %>
                                                </span>
                                            </div>
                                            <div class="card-meta">
                                                <span class="genre-badge">
                                                    <%= movie.genre %>
                                                </span>
                                                <% if (movie.rating> 0) { %>
                                                    <span class="rating-badge">‚≠ê <%= movie.rating.toFixed(1) %></span>
                                                    <% } %>
                                            </div>
                                            <p class="card-description">
                                                <%= movie.getShortDescription() %>
                                            </p>
                                            <% if (movie.director) { %>
                                                <p class="card-director">üé¨ <%= movie.director %>
                                                </p>
                                                <% } %>
                                        </div>
                                    </a>
                                    <div class="card-actions">
                                        <a href="/movies/<%= movie._id %>/edit" class="btn-icon" title="Edit">
                                            ‚úèÔ∏è
                                        </a>
                                        <form action="/movies/<%= movie._id %>?_method=DELETE" method="POST"
                                            class="delete-form"
                                            onsubmit="return confirm('Are you sure you want to delete this movie?')">
                                            <button type="submit" class="btn-icon btn-delete" title="Delete">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                <% }); %>
                        </div>
                        <% } %>
            </div>
        </main>

        <%- include('../partials/footer') %>
            <script src="/js/main.js"></script>
</body>

</html>